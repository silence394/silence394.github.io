---
title: Gamma校正
categories: 渲染
---

一、Gamma的由来
- 人眼对亮度感受的非线性， 类似于一个pow曲线，对暗部的敏感度强一些。图像中的空间有限，没必要在图像中给亮部太多空间。
- CRT显示器，阴极管发射出来的光子的亮度非线性。
早期的CRT（阴极射线管）显示器显示出来的亮度和电压的不是线性关系，而是幂次的关系：$ V_{out} = V_{in}^\gamma$输入电压得到一个亮度，但是想要将这个亮度提高一倍，却无法通过将电压提高一倍来实现。输入的电压和输出的亮度呈下图的关系。
![](http://ww1.sinaimg.cn/large/c5c3a364ly1fw6ctcxwbwj208w05gdfv.jpg)
由于CRT的这个物理特性，显示图像的亮度要比图像中存储的数值的亮度低。为了弥补这个问题，需要对图像采集设备做补偿，将图像中存储的亮度做一个逆幂次变换。经过这两次幂次变换，图像采集的图像与CRT显示的图像能够保持一致。
![](http://ww1.sinaimg.cn/large/c5c3a364ly1fw6d49ud68j208c06qgln.jpg)
对颜色施加幂次变换的过程称为Gamma校正。
- 一般CRT显示器的γ值为2.5，这个值叫**display gamma**，这个操作称为**gamma compression**。
- 对图像捕捉设备做的补偿γ为display gamma的倒数，叫做**encoding gamma**，这个操作称为**gamma expansion**。

考虑这三种人眼感受的颜色：黑色、中灰、白色。在这个亮度图中，最左边的为黑色，记为0；最右边的颜色为白色，记为1；正中间的颜色为人眼感受到的中灰（感觉上的黑白的中间点），记为0.5。
![](http://ww1.sinaimg.cn/large/c5c3a364ly1fw6eowio2yj20dw046dgr.jpg)
定义黑色的物理反射率为0%，白色的物理反射率为100%，然而 经过物理测量之后，中灰的物理反射率并不是直觉上的50%，而是20%左右。
以物理反射率从0%，100%线性变化，做出亮度变化的图：
![](http://ww1.sinaimg.cn/large/c5c3a364ly1fw6fgdia0gj20k00463ye.jpg)
中灰的地方在20%的位置，而图片的大部分都被亮色覆盖了。在这张图中很容易能得出结论：人眼对不同亮度的敏感程度也是不同的，对暗部变化的敏感要高于亮部。

而早期图像的存储空间有限，常用的RGBA32格式，其每个通道只有8位，也就是说只能存储256种亮度，所以基于人眼的特性，用更多的空间存储亮部，能够更好的利用图像的存储空间。经过科学家基于人眼特性的测量，用0.45的encoding gamma对输入的亮度进行编码，得到一张图像，显示的时候再经过$\frac{1}{0.45}$的display gamma进行解码，就可以显示原本的亮度值。
多么棒的巧合！CRT的物理特性和人眼对亮度的敏感曲线都是幂次。后来微软、爱普生、惠普共同提供了一套标准方法来定义色彩，也就是现在设计师常用的sRGB（standard Red Green Blue）。在这个标准下，display gamma值为2.2。

Gamma空间的由来。 最初CRT显示器的问题，输出的亮度和电压并不是线性关系，近似于2.2次幂的关系，看到的亮度要比实际存储的亮度要低。需要在显示器显示前，将亮度做调整，Inversegamma也就是变为自身的1/2.2次幂，就能补偿显示器造成的亮度下降了。
人眼对暗部比较敏感，早起的图片存储的色彩有限。所以提高暗部的区域，做了一次Gamma校正。也就是pow(1/2.2)的处理，也就是现在美术作图时的常用空间sRGB颜色空间。
sRGB空间的做出来图直接在显示器中显示，正好可以显示出原本的颜色。
因为在sRGB空间的图片 存储的是亮度是观察到的亮度的1/2.2幂。即美术制作的亮度值为0.5的图，经过显示器显示后亮度变为0.218。进行光照运算，将亮度变为原来的2倍。如果不做Gamma校正，0.5 *2 =1，显示的亮度为1.变为原来的4倍。这与我们想要的不一样。对贴图做Gamma校正，2.2，将亮度变为线性空间的值0.218，乘2得0.436，这时候不能直接输出，需要再做一次Gamma校正0.45，得到0.688，最后经过显示器得到0.439，就是我们想要的结果。
二、如何进行Gamma校正
- encoding gamma、display gamma
- 非线性->线性->非线性->Display

二、为什么需要Gamma校正
- 图片是在sRGB标准下做的。
- 一个贴图颜色亮度是原来的两倍，在光照着色中对颜色乘以2即可。但实际上并不是这样。虽然光照是线性的，各个不同的光照相加即可。但是贴图并不在线性空间。用没有gamma校正的显示器显示的时候，结果会比预想中的要暗。
- 如果不做gamma校正，用贴图的颜色做运算，比如乘以2，然后在显示器中显示（Display Gamma）。对非线性的输入进行运算，由显示器转换到线性空间。介绍运算的结果为啥是错的。
- mipmap 1.0 + 0.0  0.5
- 光照 Nvida skin

三、怎么使用Gamma校正

### 参考
1. https://zhuanlan.zhihu.com/p/36581276
2. https://en.wikipedia.org/wiki/Gamma_correction
3. https://www.zhihu.com/question/27467127
4. https://blog.csdn.net/candycat1992/article/details/46228771
5. https://developer.nvidia.com/gpugems/GPUGems3/gpugems3_ch24.html