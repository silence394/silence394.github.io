---
title: 颜色空间介绍
categories: 渲染
---
之前在做HDR的时候，ToneMap一直无法取得较好的效果，最后发现是颜色空间的问题。在pixelshader的时候没有把颜色的计算转换到线性空间来做，经过ToneMap处理的结果也是有问题。

之前对颜色的认知还停留在三原色的阶段，对颜色的很多概念如HSV, SRGB空间等一知半解。所以对色彩和颜色的基础知识进行了系统了学习，总结了一下。

## 一、 颜色是什么？
颜色是光给人的感觉，这句话包含了两个方面：光的特性和人眼的感觉。简单的认为颜色只是光的属性的是不准确的，因为在不同的环境下，同一种波长的光，人感觉到的颜色可能并不相同。
### 1、光的属性
在物理学中，光是一个狭窄频段内的电磁辐射。包括可见光、无线电波、微波、红外线和X射线。在可见光波段里每一种频率对应一种单独的光谱颜色。从低频到高频的光谱颜色变化为红、橙、黄、绿、蓝和紫。波长越短频率越高，能量越强，也就是说蓝光要比红光色温要搞，但是人眼感觉红色更暖，蓝色更冷。在美术领域常用的色温就是红暖，蓝冷，注意要与物理学中的区分。

太阳、灯泡等光源发射可见波段的全部频率而产生白色光。当白色光投射到一个物体上时，某些频率被反射，某些频率被吸收。在反射光中混合的频率确定了我们所能感受到的物体的颜色。如果在反射光中以低频率为主，则物体呈现为红色。我们可以说光谱中红色段有一个主频率，也就是光的颜色，即颜色。
### 2、人眼的感觉
人对色彩感知的过程可以简单的分为两个阶段：
- 识别波长：视网膜上有三种视锥细胞分别对可见光的短波长、中波长、长波长最敏感，不同的光线条件给予三种视锥细胞不同的刺激强度
- 生产色彩信号：视锥细胞的刺激传达到视神经，视神经有蓝-黄、红-绿两个色彩通道和一个传达亮度的非色彩通道。色彩通道中的黄、蓝相互对立，红、绿相互对立，即拮抗作用，最终以蓝-黄、红-绿、明暗程度的形式被传送给大脑

色彩构成的三种基本属性如下。
> 色相 Hue

又被称为色调，是颜色的首要特征，通俗的说就是红、橙、黄、绿……的特征。改变色相比同等程度地改变饱和度或亮度感受的色彩变化更大，所以是颜色的首要特征。下图就是色相环：

<img src="https://i.loli.net/2018/07/08/5b42195a81fd2.jpg" width=128 height=128 />

> 饱和度 Saturation

又被称为纯度，是指色向上的纯色混杂上白色，灰色或者其他色调的颜色，使色彩变得不饱和。越接近色环的纯色，饱和度越高。绿色的饱和度变化：

<img src="https://i.loli.net/2018/07/08/5b421f15450ac.png"/>

> 明度 Brightness

色彩的明亮程度。从全黑到色环上的纯色，明度越来越高。绿色的明度变化：

<img src="https://i.loli.net/2018/07/08/5b421f154374c.png"/>

## 二、颜色模型
根据人眼的视觉特点，将颜色按照一定的规则进行排列，将系统进行系统化的组织。这些规则建立的模型就是我们常说的颜色模型。颜色模型是在某种特定的上下文中对颜色的特性和行为的解释方法。没有哪一种模型能解释所有的颜色问题，因此使用不同的模型来帮助说明能看到的的不同的颜色特征。

当光由两个或多个具有不同主频率的光源混合而成时，我们可以改变各个光源的强度来生成一系列其他颜色的光，这些用来生成其他颜色的光源色彩成为基色。用了三种基色定义的常用的颜色模型有RGB,YIQ,和CMYK模型。在软件领域常常会提供HSV这样的直观颜色模型用于选择颜色。

### 1、RGB
基于三刺激理论，我们的眼睛通过光对失望的锥状细胞的三种视色素感受颜色。这种三种色度分别对红、绿、蓝的光最敏感。将红、绿、蓝三种颜色作为基色，就是RGB颜色模型。我们可以使用由R、G和B坐标轴定义的单位立方体来描述这个模型。坐标原点为黑色，对角坐标（1， 1， 1）代表白色。用RGB颜色模型选取颜色(0.3, 0.4, 0.5)，普通人很难知道是什么颜色，但是对RGB显示器而言是个很方便。

<img src="https://i.loli.net/2018/07/09/5b437180f33b0.png" width="50%" height="50%" />

### 2、YIQ
RGB显示器使用红、蓝、绿三种信号，电视监视器使用组合信号。形成组合视频信号的就是YIQ颜色模型。颜色的亮度信息包含在Y参数中，而色度信息（色度和饱和度）则结合在I和Q参数中。

### 3、CMYK
视频监视器通过组合屏幕磷粉发射的光生成颜色，是一种加色处理。而打印机、绘图仪之类的硬拷贝设备通过往纸上涂颜料来生成彩色图片。我们通过反射光看见颜色，是一种减色处理。

CMYK颜色使用青、品红、黄色作为基色（CMY），但是在实际使用中青色、品红色和黄色墨水的混合通常生成深灰色而不是黑色，所以把黑色（K）加上。通过混合三基色的颜料生成各种彩色，对于灰度图只使用黑色颜料就可以了。

<img src="https://i.loli.net/2018/07/09/5b437736822fc.png" width="35%" height="35%" />

### 4、HSV和HSL
HSV和HSL的颜色模型很相近，对用户来说，比RGB模型表示颜色更加直观。

两种模型中H表示色相(Hue)。该值的取值范围是[0， 360]。以60°为间隔，分别对应红、黄、绿、青、蓝、品红，构成了一个首尾相接的色环。S都表示饱和度，表示颜色的纯度。

两种颜色模型不同的是最后一个分量。
HSV中的V表示明度（Value/Brightness），HSL中的L表示亮度（Lightness）。明度是从黑色到色相颜色的程度，亮度是从最暗到色相颜色再到白色。也就是说HSL模型取最大亮度时不管饱和度和色相如何都是白色，而HSB最大明度时是色相颜色，要达到白色还需要饱和度最小。

<img src="https://i.loli.net/2018/07/09/5b437d1755ea3.png" width="35%" height="35%" />
<img src="https://i.loli.net/2018/07/09/5b437d1752fa9.png" width="35%" height="35%" />

详细信息参考Wiki：[HSV和HSL](https://en.wikipedia.org/wiki/HSL_and_HSV)

## 三、颜色空间
不同颜色模型下有一种或者多种颜色空间，在这里只介绍渲染相关的几个颜色空间。

各种设备使用的色彩空间不尽相同，高端显示器会使用Adobe RGB色彩空间，低端显示器由于显示不出那么多Adobe RGB空间的颜色，会优先使用色域较小的sRGB色彩空间。在不同设备上使用的色彩空间是设备相关的色彩空间。

设备相关的色彩空间给颜色的管理造成了很大的麻烦，因为一个色彩空间的颜色值，在另外一个色彩空间很可能是不同的，甚至是不存在的。所以将一个将各种设备相关的色彩空间的颜色都映射到一个标准的色彩空间，作为各种色彩空间转换的桥梁。这就是设备无关的色彩空间，最常见的就是CIE xyY。
### 1、CIE标准色彩空间
#### CIE 1931 RGB
在实际的基本颜色中，没有哪一组基色组合能够组合生成所有可见的颜色。三种基色对大多数情况来说是足够的，并且可以通过混色处理表现为任意第四种颜色。将一种或两种基色与第四种颜色混合，产生的颜色可以与余下基色的混色色相匹配。

科学家经过大量的实验，将三基色）用不同的量混合，得出所有的光谱色。最终的得到的结果成为色匹配函数，如下：

<img src="https://i.loli.net/2018/07/08/5b42263f46e24.png" width="50%" height="50%"/>

波长为500nm左右的光谱的颜色，无法用三原色调节的出来，但是可以通过在光谱色中加入基色光，然后再让三原色经过一定的比例的混合与之相匹配。那么得出的色匹配值就是三原色基色匹配减去在光谱色中加入的基色。500nm左右的颜色与一定量的红光混合可以得到下图中的蓝绿混合色，所以500nm的颜色只能与蓝光和绿光混合的广中“减去”红光而得到的色相匹配。这就是图像是出现负值的原因。对RGB显示器来说，不能显示500nm左右的颜色。

可以看到CIE RGB色彩空间的rg色度图横轴负半轴都是含负值的区域。

<img src="https://i.loli.net/2018/07/10/5b44cedd31240.png" width="40%" height="40%"/>

#### CIE 1931 XYZ

由于CIE RGB色彩空间的色匹配函数出现了负值，使用和计算都不方便。CIE对上面的色匹配函数进行了线性变换，使所有分量都为正值，这就是CIE XYZ颜色模型。

<img src="https://i.loli.net/2018/07/08/5b422a1623546.png" width="50%" height="50%"/>

对CIE再进行一次数学变化，把色相分布用xy平面表示出来，Y轴表示亮度，这样可以更直观的看到色彩的分布,即得到CIE xyY空间。其色度图如下：

<img src="https://i.loli.net/2018/07/10/5b44d291c73c1.png" width="50%" height="50%"/>

CIE xyY是设备无关的色彩空间，包含了一般人可见的所有颜色。色度图的马蹄形弧线边界是光谱色。连接红色和紫色的直线成为紫色线，并不属于光谱。内部的点表示所有可能的可见颜色的组合，所以一般情况下都能包含其他颜色空间。因此作为国际上色度计算、颜色测量和颜色表征的统一标准，是几乎所有测色仪器的设计与制造依据。

### 2、RGB模型的色彩空间
常见的RGB色彩空间有sRGB，Apple RGB， Adobe RGB。


**引用：**
1. https://en.wikipedia.org/wiki/CIE_1931_color_space
2. https://zhuanlan.zhihu.com/p/24214731
3. http://styletin.com/archives/535
4. https://www.jianshu.com/p/f03e9ac9c9ef