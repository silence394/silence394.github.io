---
title: 基于物理的渲染——直接光照
categories: 渲染
mathjax: true
---
上篇文章的最后引入了PBR的渲染方程：
$$
L_o = \int_{\Omega }(\frac{c_{diff}}{π}+ \frac{D(h)G(\omega_i, \omega_o,h)F(\omega_o,h)}{4(n\cdot \omega_i)(n\cdot \omega_o)})\otimes L_i(\omega_i)\cos\theta_id\omega_i
$$
在这篇文章里将介绍PBR在方向光源下的着色模型。由于是方向光源，物体表面的每一点只会被一束光照到，所以方向光源的渲染方程可以写成：
$$
L_o = (\frac{c_{diff}}{π}+ \frac{D(h)G(\omega_i, \omega_o,h)F(\omega_o,h)}{4(n\cdot \omega_i)(n\cdot \omega_o)})\otimes L_i(\omega_i)\cos\theta_i
$$
### 引入的变量
PBR渲染方程引入的变量有一下几种：
#### roughness（粗糙度）
表示了表面的粗糙程度，主要影响高光反射的计算。
#### albedo（折射率）
![](http://ww1.sinaimg.cn/mw690/c5c3a364ly1fyl37ymoyaj20hj0augnf.jpg)
所有电介质材质表面的基础反射率都不会高于0.17，这其实是例外而非普遍情况。导体材质表面的基础反射率起点更高一些并且（大多）在0.5和1.0之间变化。此外，对于导体或者金属表面而言基础反射率一般是带有色彩的，这也是为什么F0要用RGB三原色来表示的原因（法向入射的反射率可随波长不同而不同）。这种现象我们只能在金属表面观察的到。
#### metallic（金属度）
理论上一个物体的金属度非0即1。由于材质的纹理精度不足以描述一个如细沙/有刮痕的金属表面，通过在[0, 1]范围内调节金属度，可以取得非常好的效果。
- albedo 反射率 F0
- roughness 粗糙度
- metallic 金属度


### specular部分
### diffuse部分

$$
NDF_{GGX TR}(n, h, \alpha) = \frac{\alpha^2}{\pi((n \cdot h)^2 (\alpha^2 - 1) + 1)^2}
$$
$$
G_{SchlickGGX}(n, v, k) = \frac{n \cdot v}{(n \cdot v)(1 - k) + k }
$$
$$
k_{direct} = \frac{(\alpha + 1)^2}{8}
$$
$$
G(n, v, l, k) = G_{sub}(n, v, k) G_{sub}(n, l, k)
$$
$$
F_{Schlick}(n, v, F_0) = F_0 + (1 - F_0) ( 1 - (n \cdot v))^5
$$
``` glsl
diffuse = albedo * (1 - metalness)
specular = lerp(0.04, albedo, metalness)
```